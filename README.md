# 🧠 智能复习计划系统

一个基于**知识图谱 + 艾宾浩斯遗忘曲线 + 时间表调度**的个性化学习系统，帮助用户科学安排输入学习与输出练习，持续高效地推进长期目标（如考试备考、技能掌握）。

---

## 🌟 功能

- ✅ 自动排班，支持长短任务拼 slot，避免碎片化时间浪费
- ✅ 艾宾浩斯遗忘曲线优化复习时机，强化记忆曲线
- ✅ 知识图谱管理，让学习结构化、系统化
- ✅ 多种任务类型支持：阅读、视频、练习题、模拟考试等
- ✅ 支持日常和特殊时间安排，兼顾规律性与灵活性

---

## 🧠 核心调度算法：`generate_schedule_v3_ebbinghaus_full_fill`

调度过程基于 DAG（任务依赖图）和时间 slot 列表，主要逻辑如下：

### 🚀 步骤一：任务准备
- 提取未完成任务，并根据任务之间的依赖关系构建 DAG。
- 针对 output 任务，结合 `ReviewTaskLog` 历史记录，计算推荐复习日期（艾宾浩斯间隔：1、2、4、7、15 天）。

### 📊 步骤二：任务排序策略
每次为一个时间段选择任务时，按以下维度排序：

| 优先维度 | 描述 |
|----------|------|
| 学科进度 | 落后的学科优先安排 |
| 复习时机 | output 任务越接近推荐复习时间，优先级越高 |
| 时长匹配度 | 任务时长越接近 slot 剩余时间越优先 |
| 连贯性 | 与上一个任务是同一学科优先 |
| 当日频次 | 同一天内每种类型任务最多执行 2 次，避免过载 |

### 🧩 拼 Slot / 拼任务策略
- **长任务**：如果一个 slot 不够长，会自动拼接后续 slot（同一天、最多 3 个）以完成任务。
- **小任务**：多个任务可以拼接塞进一个 slot。

---

## 🖥️ 前端界面说明

### 📚 1. 知识点树
> 可视化知识图谱结构，展示主题、子主题层级关系，支持点击查看相关任务。

- 显示每个知识点的掌握度、重要性
- 支持添加、编辑、删除输入/输出材料
- 可以追踪任务完成度和复习频次

---

### 📋 2. 复习记录
> 展示用户每次复习的详细记录。

- 每条记录包含复习时间、材料、所用时长

---

### 🕒 3. 时间表
> 管理一周默认学习时间段和特殊日期安排。

- 每周 7 天的默认时间配置
- 特殊日（如节假日、考试周）可以单独设置

---

### 📆 4. 周计划
> 显示根据算法生成的排班结果，以日历形式呈现。

- 每天的任务按时间顺序排列
- 不同任务类型有图标区分（如 👀📘 输入 vs ✍️🧠 输出）
---

## 🗃️ 后端数据库设计

结构基于以下核心表：

### 🎯 考试与知识结构

| 表名 | 描述 |
|------|------|
| `Exam` | 存储考试大类（如高考） |
| `Subject` | 每个考试下的科目（如数学） |
| `TopicNode` | 构成知识图谱的树状节点，支持多层主题结构 |

---

### 📚 学习材料与任务

| 表名 | 描述 |
|------|------|
| `InputMaterial` | 输入任务，如视频、笔记、背诵内容 |
| `OutputMaterial` | 输出任务，如练习题、模拟考试，支持依赖调度 |
| `ReviewTaskLog` | 学习/复习的执行记录，包括时间、时长、备注 |

---

### ⏰ 排班系统

| 表名 | 描述 |
|------|------|
| `DefaultSchedule` | 每周默认时间表（按星期几设定） |
| `SpecialSchedule` | 特殊日期的时间安排覆盖（如节假日） |

---

## 🛠️ 启动方式

### 开发环境
```bash
# 初始化数据库
python db_init.py

# 随机插入数据
python insert_sample_data.py

# 启动后端
uvicorn main:app --host 0.0.0.0 --port 8000 --reload

# 启动前端
npm run dev
```

### 生产环境
```bash
# 启动后端
gunicorn main:app -k uvicorn.workers.UvicornWorker --bind 127.0.0.1:8000

# 编译前端
npm run build
cp ./dist/* /var/www/my-frontend/
```